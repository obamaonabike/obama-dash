<!DOCTYPE html>
<html lang="en" style="background:#050f05">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#070d07">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ObamaDash">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<title>ObamaDash</title>

<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{background:#050f05;height:100%}
body{
height:100%;
background:#050f05;
color:#00cc33;
font-family:'Share Tech Mono',monospace;
overflow:hidden;
cursor:crosshair
}
#app{display:flex;flex-direction:column;height:100%}
.bar{
display:flex;
align-items:center;
justify-content:space-between;
padding:0 10px;
height:24px;
background:#070d07;
color:#006618;
font-size:10px;
letter-spacing:2px;
text-transform:uppercase
}
.bar-title{color:#00cc33;letter-spacing:4px}
.chart-controls{
display:flex;
height:22px;
background:#070d07;
border-bottom:1px solid #0f2a0f
}
.tf-btn{
flex:1;
background:#070d07;
border:none;
border-right:1px solid #0f2a0f;
color:#003a10;
font-family:'Share Tech Mono',monospace;
font-size:10px;
letter-spacing:2px;
cursor:pointer
}
.tf-btn.active{
color:#00cc33;
background:#0a160a;
border-bottom:1px solid #00cc33
}
.chart-body{flex:1;position:relative}
#chart-container{width:100%;height:100%}
.status-dot{
width:5px;height:5px;border-radius:50%;
background:#00cc33;animation:pulse 2s infinite
}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.2}}
</style>
</head>

<body>
<div id="app">

<div class="bar">
<span class="bar-title">OBAMADASH</span>
<div style="display:flex;align-items:center;gap:8px">
<span id="hdr-price">—</span>
<div class="status-dot"></div>
</div>
</div>

<div class="chart-controls">
<button class="tf-btn" id="btn-ratio">M1 RATIO</button>
<button class="tf-btn" id="btn-both">M1 BOTH</button>
</div>

<div class="chart-body">
<div id="chart-container"></div>
</div>

<div class="bar">
<span id="bar-status">CONNECTING...</span>
<span id="bar-time">—</span>
</div>

</div>

<script>
"use strict";

/* =========================
   GLOBAL STATE
========================= */

let chart;
let candles;
let fanSeries=[];
let mode=localStorage.getItem("mode")||"ratio";
let refreshLoop=null;

/* =========================
   CONFIG (UNCHANGED LOGIC)
========================= */

const CONFIG={
symbol:"BTCUSDT",
interval:"1m",
fanRatios:[1,2,3,5,8,13,21,34,55]
};

/* =========================
   SAFE FETCH
========================= */

async function fetchJSON(url){
try{
const res=await fetch(url);
if(!res.ok)throw new Error();
return await res.json();
}catch{
document.getElementById("bar-status").textContent="OFFLINE";
return null;
}
}

/* =========================
   BUILD CHART
========================= */

function buildChart(){
chart=LightweightCharts.createChart(
document.getElementById("chart-container"),
{
layout:{background:{color:"#050f05"},textColor:"#006618"},
grid:{vertLines:{color:"#0c1a0c"},horzLines:{color:"#0c1a0c"}},
rightPriceScale:{borderColor:"#0f2a0f"},
timeScale:{borderColor:"#0f2a0f",timeVisible:true}
}
);

candles=chart.addCandlestickSeries({
upColor:"#00ff41",
downColor:"#ff3131",
borderUpColor:"#00ff41",
borderDownColor:"#ff3131",
wickUpColor:"#00aa2a",
wickDownColor:"#aa1111"
});

new ResizeObserver(e=>{
chart.applyOptions({
width:e[0].contentRect.width,
height:e[0].contentRect.height
});
}).observe(document.getElementById("chart-container"));
}

/* =========================
   LOAD DATA
========================= */

async function loadCandles(){
const data=await fetchJSON(
`https://api.binance.com/api/v3/klines?symbol=${CONFIG.symbol}&interval=${CONFIG.interval}&limit=500`
);
if(!data)return;

const formatted=data.map(d=>({
time:d[0]/1000,
open:+d[1],
high:+d[2],
low:+d[3],
close:+d[4]
}));

candles.setData(formatted);
drawFan(formatted);
}

/* =========================
   FAN ENGINE (UNCHANGED GEOMETRY)
========================= */

function drawFan(data){
fanSeries.forEach(s=>chart.removeSeries(s));
fanSeries=[];

if(data.length<50)return;

const anchor=data[data.length-50];
const basePrice=anchor.close;
const baseTime=anchor.time;

CONFIG.fanRatios.forEach(r=>{
const line=chart.addLineSeries({
color:"#004a14",
lineWidth:1,
priceLineVisible:false
});
line.setData([
{time:baseTime,value:basePrice},
{time:data[data.length-1].time,value:basePrice+(r*10)}
]);
fanSeries.push(line);
});
}

/* =========================
   MODE SWITCH
========================= */

function switchMode(m){
mode=m;
localStorage.setItem("mode",m);
document.querySelectorAll(".tf-btn").forEach(b=>b.classList.remove("active"));
if(m==="ratio")document.getElementById("btn-ratio").classList.add("active");
if(m==="both")document.getElementById("btn-both").classList.add("active");
}

/* =========================
   BOOT
========================= */

window.onload=async()=>{
buildChart();

document.getElementById("btn-ratio").onclick=()=>switchMode("ratio");
document.getElementById("btn-both").onclick=()=>switchMode("both");

switchMode(mode);

await loadCandles();

if(refreshLoop)clearInterval(refreshLoop);
refreshLoop=setInterval(loadCandles,60000);

const price=await fetchJSON(
`https://api.binance.com/api/v3/ticker/price?symbol=${CONFIG.symbol}`
);
if(price){
document.getElementById("hdr-price").textContent=
parseFloat(price.price).toLocaleString();
document.getElementById("bar-status").textContent="LIVE - BINANCE";
}

document.getElementById("bar-time").textContent=
new Date().toUTCString().slice(5,22).toUpperCase()+" UTC";
};
</script>

</body>
</html>