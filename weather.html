<!DOCTYPE html>

<html lang="en" style="background:#050f05">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#070d07">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>ObamaDash - London Temp</title>
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js" onerror="document.getElementById('bar-status').textContent='ERROR: CDN FAILED TO LOAD';"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{background:#050f05;height:100%;height:-webkit-fill-available}
body{width:100%;height:100%;height:-webkit-fill-available;min-height:100dvh;overflow:hidden;background:#050f05;color:#00cc33;font-family:"Share Tech Mono",monospace;font-size:11px;letter-spacing:.5px;cursor:crosshair;-webkit-text-size-adjust:100%}
#app{display:flex;flex-direction:column;width:100%;height:100%;min-height:100dvh;background:#050f05;overflow:hidden;touch-action:none}
.bar{flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:0 10px;height:24px;background:#070d07;color:#006618;font-size:10px;letter-spacing:2px;text-transform:uppercase}
.bar-top{border-bottom:1px solid #0f2a0f;padding-top:env(safe-area-inset-top);height:calc(24px + env(safe-area-inset-top))}
.bar-bottom{border-top:1px solid #0f2a0f;padding-top:5px;padding-bottom:calc(env(safe-area-inset-bottom) + 5px);height:auto;min-height:24px;align-items:flex-start}
.bar-title{font-size:11px;letter-spacing:4px;color:#00cc33;white-space:nowrap}
.nav-link{color:#004a14;font-family:"Share Tech Mono",monospace;font-size:9px;letter-spacing:2px;text-decoration:none;margin-left:8px}
.price-display{color:#00cc33;font-size:11px;letter-spacing:1px}
.dot{width:5px;height:5px;border-radius:50%;background:#00cc33;flex-shrink:0;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.2}}
.chart-controls{flex-shrink:0;display:flex;align-items:stretch;height:22px;background:#070d07;border-bottom:1px solid #0f2a0f}
.tf-btn{background:#070d07;border:none;border-right:1px solid #0f2a0f;color:#003a10;font-family:"Share Tech Mono",monospace;font-size:10px;letter-spacing:2px;text-transform:uppercase;padding:0 12px;cursor:pointer}
.tf-btn.active{color:#00cc33;background:#0a160a;border-bottom:1px solid #00cc33}
.chart-shell{flex:1;min-height:0;display:flex;flex-direction:column;background:#050f05}
.chart-body{flex:1;position:relative;min-height:0;overflow:hidden;background:#050f05;touch-action:none}
#chart-container{width:100%;height:100%;background:#050f05}
#err{display:none;position:absolute;top:10px;left:10px;right:10px;background:#1a0000;border:1px solid #cc0000;color:#ff4444;font-size:9px;padding:8px;letter-spacing:1px;z-index:99;word-break:break-all}
</style>
</head>
<body>
<div id="app">
  <div class="bar bar-top">
    <span class="bar-title">WX LONDON</span>
    <div>
      <a href="index.html" class="nav-link">BTC</a>
      <a href="backtest.html" class="nav-link">BT</a>
      <a href="forwardtest.html" class="nav-link">FT</a>
      <a href="wxbacktest.html" class="nav-link">WXB</a><a href="wxtest.html" class="nav-link">TST</a>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <span class="price-display" id="hdr-temp">--</span>
      <div class="dot"></div>
    </div>
  </div>
  <div class="chart-controls">
    <button class="tf-btn active" id="btn-ltf-ratio" onclick="switchMode('LTF_RATIO')">M1 RATIO</button>
    <button class="tf-btn" id="btn-ltf-both" onclick="switchMode('LTF_BOTH')">M1 BOTH</button>
    <button class="tf-btn" id="btn-htf" onclick="switchMode('HTF')">HTF</button>
  </div>
  <div class="chart-shell">
    <div class="chart-body">
      <div id="chart-container"></div>
      <div id="err"></div>
    </div>
  </div>
  <div class="bar bar-bottom">
    <span id="bar-status">LOADING...</span>
    <span id="bar-time" style="font-size:9px;letter-spacing:1px;color:#004a14"></span>
  </div>
</div>
<script>
var TMR_KEY = "geHqAXyAgDTGlnyKJGK0wJX4RiBrpHeU";
var LAT = 51.5048, LON = 0.0495;
var HTF_RATIO = 60;
var REFRESH_SEC = 300;

var chartMode = “LTF_RATIO”;
var lwChart, candleSeries, chartLevels = {};
var m1Candles = [], h1Candles = [];
var htfAnchorTs, ltfAnchorTs, htfAnchorOpen, ltfAnchorOpen;

function getMidnight() {
var n = new Date();
return new Date(Date.UTC(n.getUTCFullYear(), n.getUTCMonth(), n.getUTCDate()));
}
function get0900() {
var n = new Date();
var a = new Date(Date.UTC(n.getUTCFullYear(), n.getUTCMonth(), n.getUTCDate(), 9));
if (a > n) a.setUTCDate(a.getUTCDate() - 1);
return a;
}
function fanVal(anchor, bars, deg, ratio) {
return anchor + bars * (ratio || 1) * Math.tan(deg * Math.PI / 180);
}
function levelDefs(type) {
var r = type === “HTF_R”, h = type === “HTF”;
if (r) return [
{l:“EQ”,d:0,c:”#ffffff”},{l:”+27”,d:27,c:”#ffb300”},{l:”-27”,d:-27,c:”#ff00ff”},
{l:”+45”,d:45,c:”#ffb300”},{l:”-45”,d:-45,c:”#ff00ff”},{l:”+60”,d:60,c:”#ffb300”},
{l:”-60”,d:-60,c:”#ff00ff”},{l:”+72”,d:72,c:”#ffdd00”},{l:”-72”,d:-72,c:”#ffdd00”},
{l:”+78”,d:78,c:”#ffdd00”},{l:”-78”,d:-78,c:”#ffdd00”}
];
return [
{l:“EQ”,d:0,c:h?”#ffffff”:”#aaaaaa”},{l:”+27”,d:27,c:h?”#00ff41”:”#00cc33”},
{l:”-27”,d:-27,c:h?”#ff3131”:”#cc2222”},{l:”+45”,d:45,c:h?”#00ff41”:”#00cc33”},
{l:”-45”,d:-45,c:h?”#ff3131”:”#cc2222”},{l:”+60”,d:60,c:h?”#00ff41”:”#00cc33”},
{l:”-60”,d:-60,c:h?”#ff3131”:”#cc2222”},{l:”+72”,d:72,c:h?”#ffb300”:”#dd9900”},
{l:”-72”,d:-72,c:h?”#ffb300”:”#dd9900”},{l:”+78”,d:78,c:h?”#ffb300”:”#dd9900”},
{l:”-78”,d:-78,c:h?”#ffb300”:”#dd9900”}
];
}
function buildChart() {
var el = document.getElementById(“chart-container”);
var par = el.parentElement;
function gh() { return par.getBoundingClientRect().height || window.innerHeight - 70; }
lwChart = LightweightCharts.createChart(el, {
width: el.clientWidth, height: gh(),
layout:{background:{color:”#050f05”},textColor:”#006618”,fontSize:10},
grid:{vertLines:{color:”#0c1a0c”},horzLines:{color:”#0c1a0c”}},
crosshair:{mode:LightweightCharts.CrosshairMode.Normal,
vertLine:{color:”#00ff4166”,width:1,style:3,labelBackgroundColor:”#051405”},
horzLine:{color:”#00ff4166”,width:1,style:3,labelBackgroundColor:”#051405”}},
rightPriceScale:{borderColor:”#0f2a0f”,textColor:”#006618”,scaleMargins:{top:.08,bottom:.08}},
timeScale:{borderColor:”#0f2a0f”,timeVisible:true,secondsVisible:false},
localization:{priceFormatter:function(p){return p.toFixed(2)+“C”}}
});
candleSeries = lwChart.addCandlestickSeries({
upColor:”#00ff41”,downColor:”#ff3131”,
borderUpColor:”#00ff41”,borderDownColor:”#ff3131”,
wickUpColor:”#00aa2a”,wickDownColor:”#aa1111”
});
var t;
function rs(){clearTimeout(t);t=setTimeout(function(){lwChart.applyOptions({width:el.clientWidth,height:gh()});},80);}
window.addEventListener(“resize”,rs);
if(window.visualViewport)window.visualViewport.addEventListener(“resize”,rs);
}
function clearLevels(){
Object.values(chartLevels).forEach(function(s){try{lwChart.removeSeries(s);}catch(e){}});
chartLevels={};
}
function drawSet(candles, aTs, aOpen, type, ratio) {
if (!aOpen || !candles.length) return;
var defs = levelDefs(type);
var aSec = aTs.getTime() / 1000;
var spb = (type===“HTF”||type===“HTF_R”) ? 3600 : 60;
var filt = candles.filter(function(c){return c.time >= aSec;});
if (filt.length < 2) return;
var last = filt[filt.length-1];
var n = new Date();
var endSec = new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),23,59)).getTime()/1000;
var fut = [];
for (var t = last.time+60; t <= endSec; t+=60) fut.push(t);
defs.forEach(function(def){
var data = filt.map(function(c){return{time:c.time,value:fanVal(aOpen,Math.floor((c.time-aSec)/spb),def.d,ratio||1)};});
fut.forEach(function(t){data.push({time:t,value:fanVal(aOpen,Math.floor((t-aSec)/spb),def.d,ratio||1)});});
var pfx = type===“HTF_R”?“R”:type===“HTF”?“H”:“L”;
var s = lwChart.addLineSeries({color:def.c,lineWidth:1,lineStyle:type===“LTF”?2:0,priceLineVisible:false,lastValueVisible:true,title:pfx+def.l,crosshairMarkerVisible:false});
s.setData(data);
chartLevels[type+”_”+def.l]=s;
});
}
function reloadLevels(){
clearLevels();
var c = chartMode===“HTF” ? h1Candles : m1Candles;
if (chartMode===“HTF”) {
drawSet(c,htfAnchorTs,htfAnchorOpen,“HTF”,1);
drawSet(c,htfAnchorTs,htfAnchorOpen,“HTF_R”,HTF_RATIO);
drawSet(c,ltfAnchorTs,ltfAnchorOpen,“LTF”);
} else if (chartMode===“LTF_RATIO”) {
drawSet(c,htfAnchorTs,htfAnchorOpen,“HTF_R”,HTF_RATIO);
drawSet(c,ltfAnchorTs,ltfAnchorOpen,“LTF”);
} else {
drawSet(c,htfAnchorTs,htfAnchorOpen,“HTF”,1);
drawSet(c,htfAnchorTs,htfAnchorOpen,“HTF_R”,HTF_RATIO);
drawSet(c,ltfAnchorTs,ltfAnchorOpen,“LTF”);
}
}

function omToCandles15(d) {
var times = d.minutely_15 && d.minutely_15.time || [];
var temps = d.minutely_15 && d.minutely_15.temperature_2m || [];
var rows = [];
for (var i=0; i<times.length; i++) {
if (temps[i]==null) continue;
// open-meteo format: “2026-02-21T00:00” - needs Z
var ts = Math.floor(new Date(times[i]+“Z”).getTime()/1000);
rows.push({ts:ts, temp:temps[i]});
}
var out = [];
for (var i=0; i<rows.length; i++) {
var o = i===0 ? rows[i].temp : rows[i-1].temp;
var c = rows[i].temp;
// expand each 15min slot into 15 x 1min candles
for (var m=0; m<15; m++) {
out.push({time:rows[i].ts-(14-m)*60,open:o,high:Math.max(o,c),low:Math.min(o,c),close:c});
}
}
return out;
}
function omToH1(d) {
var times = d.hourly && d.hourly.time || [];
var temps = d.hourly && d.hourly.temperature_2m || [];
var rows = [];
for (var i=0; i<times.length; i++) {
if (temps[i]==null) continue;
rows.push({ts:Math.floor(new Date(times[i]+“Z”).getTime()/1000),temp:temps[i]});
}
return rows.map(function(r,i){
var o=i===0?r.temp:rows[i-1].temp, c=r.temp;
return{time:r.ts,open:o,high:Math.max(o,c),low:Math.min(o,c),close:c};
});
}
function tmrToCandles(rows) {
return rows.map(function(r,i,a){
var o=i===0?r.values.temperature:a[i-1].values.temperature;
var c=r.values.temperature;
return{time:Math.floor(new Date(r.time).getTime()/1000),open:o,high:Math.max(o,c),low:Math.min(o,c),close:c};
});
}
function merge(a,b){
var map={};
a.forEach(function(c){map[c.time]=c;});
b.forEach(function(c){if(!map[c.time])map[c.time]=c;});
return Object.values(map).sort(function(x,y){return x.time-y.time;});
}
function anchorOpen(candles, ts) {
var sec=ts.getTime()/1000;
for(var i=0;i<candles.length;i++){if(Math.abs(candles[i].time-sec)<960)return candles[i].open;}
return candles.length?candles[0].open:null;
}
function showErr(msg){
var e=document.getElementById(“err”);
e.textContent=msg; e.style.display=“block”;
setTimeout(function(){e.style.display=“none”;},10000);
}

function loadAll() {
document.getElementById(“bar-status”).textContent=“FETCHING…”;
htfAnchorTs=getMidnight();
ltfAnchorTs=get0900();

// Open-Meteo: past_days for history + forecast_days for future – no auth
var omUrl = “https://api.open-meteo.com/v1/forecast?latitude=”+LAT+”&longitude=”+LON
+”&minutely_15=temperature_2m&hourly=temperature_2m”
+”&temperature_unit=celsius&timezone=UTC&past_days=3&forecast_days=2”;

// Tomorrow.io: minutely forecast for next hour
var tmrUrl = “https://api.tomorrow.io/v4/weather/forecast?location=”+LAT+”,”+LON
+”&fields=temperature&timesteps=1m,1h&units=metric&apikey=”+TMR_KEY;

var p1 = fetch(omUrl).then(function(r){
if(!r.ok) throw new Error(“OM “+r.status);
return r.json();
});
var p2 = fetch(tmrUrl).then(function(r){
if(!r.ok) throw new Error(“TMR “+r.status);
return r.json();
}).catch(function(e){showErr(“TMR forecast: “+e.message);return null;});

Promise.all([p1,p2]).then(function(res){
var om=res[0], tmr=res[1];
var histM1=omToCandles15(om);
var histH1=omToH1(om);
var foreM1=tmr&&tmr.timelines&&tmr.timelines.minutely ? tmrToCandles(tmr.timelines.minutely) : [];
var foreH1=tmr&&tmr.timelines&&tmr.timelines.hourly   ? tmrToCandles(tmr.timelines.hourly)   : [];

```
m1Candles=merge(histM1,foreM1);
h1Candles=merge(histH1,foreH1);

htfAnchorOpen=anchorOpen(h1Candles,htfAnchorTs);
ltfAnchorOpen=anchorOpen(m1Candles,ltfAnchorTs);

var now=Date.now()/1000;
for(var i=m1Candles.length-1;i>=0;i--){
  if(m1Candles[i].time<=now){
    document.getElementById("hdr-temp").textContent=m1Candles[i].close.toFixed(1)+"C";
    break;
  }
}

var candles=chartMode==="HTF"?h1Candles:m1Candles;
candleSeries.setData(candles);
reloadLevels();

var vis=candles.filter(function(c){return c.time<=now;});
if(vis.length){
  var last=vis[vis.length-1];
  lwChart.timeScale().setVisibleRange({
    from:last.time-(chartMode==="HTF"?3600*12:60*120),
    to:last.time+(chartMode==="HTF"?3600*4:60*60)
  });
}
document.getElementById("bar-status").textContent=tmr?"LIVE - OM+TMR":"LIVE - OPEN-METEO";
```

}).catch(function(e){
document.getElementById(“bar-status”).textContent=“ERROR”;
showErr(e.message);
console.error(e);
});
}

function switchMode(m){
chartMode=m;
[“ltf-ratio”,“ltf-both”,“htf”].forEach(function(id){
var el=document.getElementById(“btn-”+id);
if(el)el.classList.remove(“active”);
});
var id=m===“LTF_RATIO”?“ltf-ratio”:m===“LTF_BOTH”?“ltf-both”:“htf”;
var el=document.getElementById(“btn-”+id);
if(el)el.classList.add(“active”);
var c=m===“HTF”?h1Candles:m1Candles;
if(c.length){candleSeries.setData(c);reloadLevels();}
}

window.onerror=function(msg,src,line,col,err){document.getElementById(“bar-status”).textContent=“JS ERR: “+msg+” L”+line;return false;};
window.addEventListener(“load”,function(){
try{buildChart();}catch(e){document.getElementById(“bar-status”).textContent=“buildChart ERR: “+e.message;return;}
requestAnimationFrame(function(){setTimeout(function(){window.dispatchEvent(new Event(“resize”));},150);});
setInterval(function(){
document.getElementById(“bar-time”).textContent=new Date().toUTCString().slice(5,22).toUpperCase()+” UTC”;
},1000);
try{loadAll();}catch(e){document.getElementById(“bar-status”).textContent=“loadAll ERR: “+e.message;}
setInterval(loadAll,REFRESH_SEC*1000);
});
</script>

</body>
</html>